import{a as ae,b as le,c as se}from"./chunk-OYY7KTPE.js";import{a as ne,b as re}from"./chunk-KUJPDREA.js";import{b as v,c as P,d as J,f as W,h as X,i as Y,j as Z,k as ee,l as te,m as ie,n as oe}from"./chunk-SV6MIWWK.js";import"./chunk-RW22PKBS.js";import{a as y,b as z}from"./chunk-FWAAACPL.js";import{d as Q}from"./chunk-7GBBFKJ2.js";import{a as b}from"./chunk-ZV7SFPXG.js";import{Fa as k,Ka as d,Ma as a,Nb as E,O as C,Pa as u,Ra as $,Sa as H,Ta as O,Tb as D,U as s,Ua as l,Va as r,Wa as S,Y as F,Ya as M,Za as g,_a as m,a as R,db as j,ea as h,eb as N,fa as _,fb as A,gb as U,hb as p,ib as w,k as x,lb as V,mb as q,nb as K,o as L,x as I,za as n}from"./chunk-O6BTFPW4.js";import{a as B,b as G}from"./chunk-EQDQRRRY.js";var ce=(()=>{class t{url=y.apiUrl;http=s(b);getAllUsers(){return this.http.get(this.url+"admin/accounts",{observe:"response"})}createUser(e){return this.http.post(this.url+"admin/accounts",e,{observe:"response"})}deleteUser(e){return this.http.delete(this.url+"admin/accounts/"+e,{observe:"response"})}static \u0275fac=function(o){return new(o||t)};static \u0275prov=C({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var me=[{label:"plus",value:"icons/heroicons/outline/plus-circle.svg"},{label:"minus",value:"icons/heroicons/outline/minus.svg"},{label:"calendar",value:"icons/heroicons/outline/calendar.svg"},{label:"cog",value:"icons/heroicons/outline/cog.svg"},{label:"list",value:"icons/heroicons/outline/list.svg"},{label:"document",value:"icons/heroicons/solid/document.svg"},{label:"gift",value:"icons/heroicons/outline/gift.svg"}];var pe=(()=>{class t{icons=me;getIcon(e){console.log(e);let o=this.icons.find(i=>i.label===e)?.value||"wala";return console.log(o),o}static \u0275fac=function(o){return new(o||t)};static \u0275prov=C({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var de=(()=>{class t{url=y.apiUrl;http=s(b);getRoles(){return this.http.get(this.url+"admin/roles",{observe:"response"})}static \u0275fac=function(o){return new(o||t)};static \u0275prov=C({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var _e=()=>[],ge=t=>({"!outline-red-500":t});function Ce(t,c){if(t&1&&(l(0,"option",3),p(1),r()),t&2){let e=m();n(),w(e.placeholder)}}function ve(t,c){if(t&1&&(l(0,"option",4),p(1),r()),t&2){let e=c.$implicit;a("value",e.value),n(),w(e.label)}}function be(t,c){if(t&1&&(l(0,"div",5),p(1),r()),t&2){let e=m();n(),w(e.getErrorMessage())}}var ue=(()=>{class t{formGroup;controlName;label;placeholder="";options;labelClass=[];formValidationService=s(ne);get formControl(){return this.formGroup.get(this.controlName)}getErrorMessage(){return this.formValidationService.getErrorMessage(this.formControl.errors)}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=F({type:t,selectors:[["jlc-select-field"]],inputs:{formGroup:"formGroup",controlName:"controlName",label:"label",placeholder:"placeholder",options:"options",labelClass:"labelClass"},standalone:!0,features:[V],decls:8,vars:13,consts:[[1,"block","w-full","text-left","my-2","float-left",3,"formGroup"],[1,"block","text-xxs","font-medium","text-gray-600","mb-1",3,"for","ngClass"],[1,"block","w-full","rounded-lg","py-[10px]","px-3","font-normal","text-xs","bg-white","text-gray-600","border-0","border-r-[14px]","border-transparent","outline","outline-1","outline-gray-300","focus:outline-gray-500","focus-visible:outline-gray-500","hover:outline-gray-500",3,"formControlName","id","name","ngClass"],["disabled","","value","","selected",""],[3,"value"],[1,"text-red-500","text-xs","mt-1"]],template:function(o,i){o&1&&(l(0,"div",0)(1,"label",1),p(2),r(),l(3,"select",2),d(4,Ce,2,1,"option",3),H(5,ve,2,2,"option",4,$),r(),d(7,be,2,1,"div",5),r()),o&2&&(a("formGroup",i.formGroup),n(),a("for",i.controlName)("ngClass",i.labelClass.length>0?i.labelClass:q(10,_e)),n(),w(i.label),n(),a("formControlName",i.controlName)("id",i.controlName)("name",i.controlName)("ngClass",K(11,ge,i.formControl.invalid&&(i.formControl.dirty||i.formControl.touched))),n(),u(i.placeholder?4:-1),n(),O(i.options),n(2),u(i.formControl.invalid&&(i.formControl.dirty||i.formControl.touched)?7:-1))},dependencies:[D,E,oe,ee,te,Z,P,J,X,Y],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}return t})();var fe=(()=>{class t{url=y.apiUrl;http=s(b);getSkills(){return this.http.get(`${this.url}/skills`,{observe:"response"})}createSkills(e){return this.http.post(`${this.url}/skills`,e,{observe:"response"})}static \u0275fac=function(o){return new(o||t)};static \u0275prov=C({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ye=["userDialog"],xe=["skillsDialog"];function Se(t,c){t&1&&(l(0,"div",2),S(1,"app-loading"),r())}function Ue(t,c){t&1&&p(0,"View")}function we(t,c){t&1&&p(0,"Add")}function Te(t,c){if(t&1&&(l(0,"h1",7),d(1,Ue,1,0)(2,we,1,0),p(3," Technician "),r()),t&2){let e=m(2);n(),u(e.isViewUser?1:2)}}function Fe(t,c){t&1&&p(0,"View")}function ke(t,c){t&1&&p(0,"Add")}function Me(t,c){if(t&1&&(l(0,"h1",7),d(1,Fe,1,0)(2,ke,1,0),p(3," User"),r()),t&2){let e=m(2);n(),u(e.isViewUser?1:2)}}function Ve(t,c){if(t&1){let e=M();l(0,"app-button",20),g("action",function(){let i;h(e);let f=m(2);return _(f.deleteUser(+((i=f.createUserForm.get("id"))==null?null:i.value)))}),r()}}function Ee(t,c){if(t&1&&S(0,"jlc-select-field",12),t&2){let e=m(2);a("formGroup",e.createUserForm)("options",e.rolesOption)}}function De(t,c){if(t&1){let e=M();l(0,"app-button",21),g("action",function(){h(e),m();let i=U(16);return _(i.showModal())}),r()}if(t&2){let e=m(2);a("buttonStyle","primary")("icon",e.utilityS.getIcon("plus"))}}function Ie(t,c){if(t&1){let e=M();l(0,"dialog",3,0)(2,"div",4)(3,"div",5)(4,"div",6),d(5,Te,4,1,"h1",7)(6,Me,4,1,"h1",7),r(),d(7,Ve,1,0,"app-button",8),r(),S(8,"app-form-field",9)(9,"app-form-field",10)(10,"app-form-field",11),d(11,Ee,1,2,"jlc-select-field",12),l(12,"div",13)(13,"app-button",14),g("action",function(){h(e);let i=m();return _(i.createUser())}),r(),l(14,"app-button",15),g("action",function(){h(e);let i=U(1);return _(i.close())}),r()()()(),l(15,"dialog",3,1)(17,"div",4)(18,"div",5)(19,"div",6)(20,"h1",7),p(21,"Add Skill"),r()()(),S(22,"app-form-field",9),l(23,"div",13)(24,"app-button",14),g("action",function(){h(e);let i=m();return _(i.createUser())}),r(),l(25,"app-button",15),g("action",function(){h(e);let i=U(16);return _(i.close())}),r()()()(),l(26,"div",16)(27,"app-button",17),g("action",function(){h(e);let i=U(1);return _(i.showModal())}),r(),d(28,De,1,2,"app-button",18),r(),l(29,"app-table",19),g("data",function(i){h(e);let f=m();return _(f.viewUser(i))}),r()}if(t&2){let e=m();n(3),a("ngClass",e.isViewUser?"justify-between":"justify-center"),n(2),u(e.isTechnicianList?5:6),n(2),u(e.isViewUser?7:-1),n(),a("label","Name")("formGroup",e.createUserForm),n(),a("label","Email")("formGroup",e.createUserForm),n(),a("label","Password")("formGroup",e.createUserForm)("type","password"),n(),u(e.isTechnicianList?-1:11),n(2),a("actionText","Save")("buttonStyle","primary")("loading",e.loadingButton())("disabled",!e.createUserForm.valid||e.loadingButton()),n(),a("actionText","Cancel")("buttonStyle","danger"),n(4),a("ngClass",e.isViewUser?"justify-between":"justify-center"),n(4),a("label","Skill")("formGroup",e.createUserForm),n(2),a("actionText","Save")("buttonStyle","primary")("loading",e.loadingButton())("disabled",!e.createUserForm.valid||e.loadingButton()),n(),a("actionText","Cancel")("buttonStyle","danger"),n(2),a("actionText",e.isTechnicianList?"Add Technician":"Add User")("buttonStyle","primary")("icon",e.utilityS.getIcon("plus")),n(),u(e.isTechnicianList?28:-1),n(),a("data$",e.data)("columns",e.tableColumns)("searchKey$",e.searchKey$)}}var Ut=(()=>{class t{modal;skillmodal;data;isTechnicianList=!1;searchKey=new W;searchKey$=this.searchKey.valueChanges;roles;isViewUser=!1;tableColumns=[{name:"ID No.",tableBodyType:"text",tableHeaderType:"text",key:"id",class:"w-1/3"},{name:"Name",tableBodyType:"text",tableHeaderType:"text",key:"name",class:"w-1/3"},{name:"Email",tableBodyType:"text",tableHeaderType:"text",key:"email",class:"w-1/3"},{name:"Active",tableBodyType:"text",tableHeaderType:"text",key:"is_enabled",class:"w-1/3"},{name:"Created",tableBodyType:"text",tableHeaderType:"text",key:"created_at",class:"w-1/3"}];loadingFetchApi=k(!1);loadingButton=k(!1);loadingDeleteButton=k(!1);createUserForm;skillsForm;userSubscription=new R;userServices=s(ce);route=s(Q);fb=s(ie);userRoles=s(de);alert=s(z);skillService=s(fe);utilityS=s(pe);rolesOption=[];ngOnInit(){this.fetchUsers(),this.getRoles(),this.initializeUserForm(),this.initializeSkillsForm()}initializeUserForm(){let e;this.isTechnicianList?e="4":e=void 0,this.createUserForm=this.fb.group({id:[null],name:["",[v.required]],email:["",[v.required,v.email]],password:["",[v.required]],user_role_id:[e,[v.required]]})}initializeSkillsForm(){this.skillsForm=this.fb.group({skill:["",[v.required]]})}fetchUsers(){this.loadingFetchApi.set(!0),this.userSubscription.add(this.userServices.getAllUsers().subscribe({next:e=>{this.data=x(e.body?.data.map(o=>G(B({},o),{created_at:new Date(o.created_at).toDateString(),is_enabled:o.is_enabled===1?"Active":"Inactive"})).sort((o,i)=>o.id-i.id)),this.route.snapshot.routeConfig?.path==="users?accountType=technician"&&(this.isTechnicianList=!0,this.data=this.data.pipe(L(o=>o.filter(i=>i.user_role.name==="technician"))))},complete:()=>{this.loadingFetchApi.set(!1)}}))}getRoles(){this.userRoles.getRoles().subscribe({next:e=>{let o=e.body;this.roles=o?.data,this.rolesOption=(this.roles??[]).map(i=>({value:i.id,label:i.name.charAt(0).toUpperCase()+i.name.slice(1)}))}})}createUser(){this.isTechnicianList&&(this.createUserForm.removeControl("id"),this.createUserForm.get("user_role_id")?.setValue("4")),this.createUserForm.valid&&(this.loadingButton.set(!0),this.createUserForm.removeControl("id"),this.userSubscription.add(this.userServices.createUser(this.createUserForm.value).pipe(I(e=>(e.status===500&&this.alert.handleError("Something went wrong"),e.status===422&&this.alert.handleError(e.error.message),x(e)))).subscribe({next:()=>{this.fetchUsers(),this.createUserForm.reset()},complete:()=>{this.loadingButton.set(!1),this.createUserForm.reset(),this.fetchUsers(),this.closeDialog()}})))}createSkill(){this.loadingButton.set(!0),this.createUserForm.removeControl("id"),this.userSubscription.add(this.skillService.createSkills(this.skillsForm.value).pipe(I(e=>(e.status===500&&this.alert.handleError("Something went wrong"),e.status===422&&this.alert.handleError(e.error.message),x(e)))).subscribe({next:()=>{this.createUserForm.reset()},complete:()=>{this.loadingButton.set(!1),this.createUserForm.reset(),this.fetchSkills(),this.closeSkillDialog()}}))}fetchSkills(){this.skillService.getSkills().subscribe({next:e=>{this.data=x(e.body?.data.sort((o,i)=>o.id-i.id))},complete:()=>{this.loadingFetchApi.set(!1)}})}viewUser(e){this.isViewUser=!0,this.createUserForm.patchValue(e),this.modal.nativeElement.showModal()}deleteUser(e){this.loadingDeleteButton.set(!0),this.userSubscription.add(this.userServices.deleteUser(e).subscribe({next:()=>{this.fetchUsers()},complete:()=>{this.loadingDeleteButton.set(!1),this.createUserForm.reset(),this.fetchUsers(),this.modal.nativeElement.close()}}))}closeDialog(){this.modal.nativeElement.close(),this.isViewUser=!1}closeSkillDialog(){this.skillmodal.nativeElement.close(),this.isViewUser=!1}ngOnDestroy(){this.userSubscription.unsubscribe()}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=F({type:t,selectors:[["app-user-management"]],viewQuery:function(o,i){if(o&1&&(j(ye,5),j(xe,5)),o&2){let f;N(f=A())&&(i.modal=f.first),N(f=A())&&(i.skillmodal=f.first)}},standalone:!0,features:[V],decls:2,vars:1,consts:[["userDialog",""],["skillsDialog",""],[1,"flex","h-[90vh]","justify-center","items-center"],[1,"rounded-lg","w-3/12"],[1,"flex","flex-col","h-auto","p-4","rounded-lg"],[1,"flex","flex-row",3,"ngClass"],[1,"flex","flex-row","w-full"],[1,"text-2xl"],["actionText","Delete","buttonStyle","danger","loadingText","Deleting..."],["controlName","name",3,"label","formGroup"],["controlName","email",3,"label","formGroup"],["controlName","password",3,"label","formGroup","type"],["controlName","user_role_id","placeholder","Select Role",3,"formGroup","options"],[1,"button","flex","w-full","justify-end","gap-2"],["loadingText","Saving...",3,"action","actionText","buttonStyle","loading","disabled"],[3,"action","actionText","buttonStyle"],[1,"flex","justify-start","gap-1"],[3,"action","actionText","buttonStyle","icon"],["actionText","Add Skill",3,"buttonStyle","icon"],[3,"data","data$","columns","searchKey$"],["actionText","Delete","buttonStyle","danger","loadingText","Deleting...",3,"action"],["actionText","Add Skill",3,"action","buttonStyle","icon"]],template:function(o,i){o&1&&d(0,Se,2,0,"div",2)(1,Ie,30,33),o&2&&u(i.loadingFetchApi()?0:1)},dependencies:[ae,D,E,le,se,re,ue],encapsulation:2})}return t})();export{Ut as UserManagementComponent};
