import{a as Q,b as O,c as z,d as P,e as J}from"./chunk-PPLIQ6CN.js";import{b,f as $,o as q,r as H,s as K}from"./chunk-WGHNYQUM.js";import{a as T,b as N}from"./chunk-4U4QGEFV.js";import"./chunk-RCF4RAAF.js";import{a as w,g as L}from"./chunk-MZ4IBQOD.js";import{$a as c,Ea as U,Ja as f,La as a,N as v,Oa as h,Ob as I,T as l,Ta as s,Ua as r,Ub as G,Va as x,X as j,Za as S,_a as _,a as B,da as p,ea as u,eb as k,fb as V,gb as M,hb as y,ib as g,k as C,mb as R,o as A,w as F,ya as o}from"./chunk-DSI57U6V.js";import{a as E,b as D}from"./chunk-EQDQRRRY.js";var X=(()=>{class t{url=T.apiUrl;http=l(w);getRoles(){return this.http.get(this.url+"admin/roles",{observe:"response"})}static \u0275fac=function(i){return new(i||t)};static \u0275prov=v({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Y=(()=>{class t{url=T.apiUrl;http=l(w);getSkills(){return this.http.get(`${this.url}/skills`,{observe:"response"})}createSkills(e){return this.http.post(`${this.url}/skills`,e,{observe:"response"})}static \u0275fac=function(i){return new(i||t)};static \u0275prov=v({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Z=["userDialog"],ee=["skillsDialog"];function te(t,m){t&1&&(s(0,"div",2),x(1,"app-loading"),r())}function ie(t,m){t&1&&g(0,"View")}function ne(t,m){t&1&&g(0,"Add")}function oe(t,m){if(t&1&&(s(0,"h1",7),f(1,ie,1,0)(2,ne,1,0),g(3," Technician "),r()),t&2){let e=c(2);o(),h(e.isViewUser?1:2)}}function re(t,m){t&1&&g(0,"View")}function ae(t,m){t&1&&g(0,"Add")}function se(t,m){if(t&1&&(s(0,"h1",7),f(1,re,1,0)(2,ae,1,0),g(3," User"),r()),t&2){let e=c(2);o(),h(e.isViewUser?1:2)}}function le(t,m){if(t&1){let e=S();s(0,"app-button",21),_("action",function(){let n;p(e);let d=c(2);return u(d.deleteUser(+((n=d.createUserForm.get("id"))==null?null:n.value)))}),r()}}function ce(t,m){if(t&1&&x(0,"jlc-select-field",12),t&2){let e=c(2);a("formGroup",e.createUserForm)("options",e.rolesOption)}}function me(t,m){if(t&1){let e=S();s(0,"app-button",22),_("action",function(){p(e),c();let n=y(16);return u(n.showModal())}),r()}if(t&2){let e=c(2);a("buttonStyle","primary")("icon",e.utilityS.getIcon("plus"))}}function de(t,m){if(t&1){let e=S();s(0,"dialog",3,0)(2,"div",4)(3,"div",5)(4,"div",6),f(5,oe,4,1,"h1",7)(6,se,4,1,"h1",7),r(),f(7,le,1,0,"app-button",8),r(),x(8,"app-form-field",9)(9,"app-form-field",10)(10,"app-form-field",11),f(11,ce,1,2,"jlc-select-field",12),s(12,"div",13)(13,"app-button",14),_("action",function(){p(e);let n=c();return u(n.createUser())}),r(),s(14,"app-button",15),_("action",function(){p(e);let n=y(1);return u(n.close())}),r()()()(),s(15,"dialog",3,1)(17,"div",4)(18,"div",5)(19,"div",6)(20,"h1",16),g(21,"Add Skill"),r()()(),x(22,"app-form-field",9),s(23,"div",13)(24,"app-button",14),_("action",function(){p(e);let n=c();return u(n.createUser())}),r(),s(25,"app-button",15),_("action",function(){p(e);let n=y(16);return u(n.close())}),r()()()(),s(26,"div",17)(27,"app-button",18),_("action",function(){p(e);let n=y(1);return u(n.showModal())}),r(),f(28,me,1,2,"app-button",19),r(),s(29,"app-table",20),_("data",function(n){p(e);let d=c();return u(d.viewUser(n))}),r()}if(t&2){let e=c();o(3),a("ngClass",e.isViewUser?"justify-between":"justify-center"),o(2),h(e.isTechnicianList?5:6),o(2),h(e.isViewUser?7:-1),o(),a("label","Name")("formGroup",e.createUserForm),o(),a("label","Email")("formGroup",e.createUserForm),o(),a("label","Password")("formGroup",e.createUserForm)("type","password"),o(),h(e.isTechnicianList?-1:11),o(2),a("actionText","Save")("buttonStyle","primary")("loading",e.loadingButton())("disabled",!e.createUserForm.valid||e.loadingButton()),o(),a("actionText","Cancel")("buttonStyle","danger"),o(4),a("ngClass",e.isViewUser?"justify-between":"justify-center"),o(4),a("label","Skill")("formGroup",e.createUserForm),o(2),a("actionText","Save")("buttonStyle","primary")("loading",e.loadingButton())("disabled",!e.createUserForm.valid||e.loadingButton()),o(),a("actionText","Cancel")("buttonStyle","danger"),o(2),a("actionText",e.isTechnicianList?"Add Technician":"Add User")("buttonStyle","primary")("icon",e.utilityS.getIcon("plus")),o(),h(e.isTechnicianList?28:-1),o(),a("data$",e.data)("columns",e.tableColumns)("searchKey$",e.searchKey$)}}var Ne=(()=>{class t{modal;skillmodal;data;isTechnicianList=!1;searchKey=new $;searchKey$=this.searchKey.valueChanges;roles;isViewUser=!1;tableColumns=[{name:"ID No.",tableBodyType:"text",tableHeaderType:"text",key:"id",class:"w-1/3"},{name:"Name",tableBodyType:"text",tableHeaderType:"text",key:"name",class:"w-1/3"},{name:"Email",tableBodyType:"text",tableHeaderType:"text",key:"email",class:"w-1/3"},{name:"Active",tableBodyType:"text",tableHeaderType:"text",key:"is_enabled",class:"w-1/3"},{name:"Created",tableBodyType:"text",tableHeaderType:"text",key:"created_at",class:"w-1/3"}];loadingFetchApi=U(!1);loadingButton=U(!1);loadingDeleteButton=U(!1);createUserForm;skillsForm;userSubscription=new B;userServices=l(O);route=l(L);fb=l(q);userRoles=l(X);alert=l(N);skillService=l(Y);utilityS=l(H);rolesOption=[];ngOnInit(){this.fetchUsers(),this.getRoles(),this.initializeUserForm(),this.initializeSkillsForm()}initializeUserForm(){let e;this.isTechnicianList?e="4":e=void 0,this.createUserForm=this.fb.group({id:[null],name:["",[b.required]],email:["",[b.required,b.email]],password:["",[b.required]],user_role_id:[e,[b.required]]})}initializeSkillsForm(){this.skillsForm=this.fb.group({skill:["",[b.required]]})}fetchUsers(){this.loadingFetchApi.set(!0),this.userSubscription.add(this.userServices.getAllUsers().subscribe({next:e=>{this.data=C(e.body?.data.map(i=>D(E({},i),{created_at:new Date(i.created_at).toDateString(),is_enabled:i.is_enabled===1?"Active":"Inactive"})).sort((i,n)=>i.id-n.id)),this.route.snapshot.routeConfig?.path==="users?accountType=technician"&&(this.isTechnicianList=!0,this.data=this.data.pipe(A(i=>i.filter(n=>n.user_role.name==="technician"))))},complete:()=>{this.loadingFetchApi.set(!1)}}))}getRoles(){this.userRoles.getRoles().subscribe({next:e=>{let i=e.body;this.roles=i?.data,this.rolesOption=(this.roles??[]).map(n=>({value:n.id,label:n.name.charAt(0).toUpperCase()+n.name.slice(1)}))}})}createUser(){this.isTechnicianList&&(this.createUserForm.removeControl("id"),this.createUserForm.get("user_role_id")?.setValue("4")),this.createUserForm.valid&&(this.loadingButton.set(!0),this.createUserForm.removeControl("id"),this.userSubscription.add(this.userServices.createUser(this.createUserForm.value).pipe(F(e=>(e.status===500&&this.alert.handleError("Something went wrong"),e.status===422&&this.alert.handleError(e.error.message),C(e)))).subscribe({next:()=>{this.fetchUsers(),this.createUserForm.reset()},complete:()=>{this.loadingButton.set(!1),this.createUserForm.reset(),this.fetchUsers(),this.closeDialog()}})))}createSkill(){this.loadingButton.set(!0),this.createUserForm.removeControl("id"),this.userSubscription.add(this.skillService.createSkills(this.skillsForm.value).pipe(F(e=>(e.status===500&&this.alert.handleError("Something went wrong"),e.status===422&&this.alert.handleError(e.error.message),C(e)))).subscribe({next:()=>{this.createUserForm.reset()},complete:()=>{this.loadingButton.set(!1),this.createUserForm.reset(),this.fetchSkills(),this.closeSkillDialog()}}))}fetchSkills(){this.skillService.getSkills().subscribe({next:e=>{this.data=C(e.body?.data.sort((i,n)=>i.id-n.id))},complete:()=>{this.loadingFetchApi.set(!1)}})}viewUser(e){this.isViewUser=!0,this.createUserForm.patchValue(e),this.modal.nativeElement.showModal()}deleteUser(e){this.loadingDeleteButton.set(!0),this.userSubscription.add(this.userServices.deleteUser(e).subscribe({next:()=>{this.fetchUsers()},complete:()=>{this.loadingDeleteButton.set(!1),this.createUserForm.reset(),this.fetchUsers(),this.modal.nativeElement.close()}}))}closeDialog(){this.modal.nativeElement.close(),this.isViewUser=!1}closeSkillDialog(){this.skillmodal.nativeElement.close(),this.isViewUser=!1}ngOnDestroy(){this.userSubscription.unsubscribe()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=j({type:t,selectors:[["app-user-management"]],viewQuery:function(i,n){if(i&1&&(k(Z,5),k(ee,5)),i&2){let d;V(d=M())&&(n.modal=d.first),V(d=M())&&(n.skillmodal=d.first)}},standalone:!0,features:[R],decls:2,vars:1,consts:[["userDialog",""],["skillsDialog",""],[1,"flex","h-[90vh]","justify-center","items-center"],[1,"rounded-lg","w-3/12"],[1,"flex","flex-col","h-auto","p-4","rounded-lg"],[1,"flex","flex-row",3,"ngClass"],[1,"flex","flex-row","w-full"],[1,"text-2xl"],["actionText","Delete","buttonStyle","danger","loadingText","Deleting..."],["controlName","name",3,"label","formGroup"],["controlName","email",3,"label","formGroup"],["controlName","password",3,"label","formGroup","type"],["controlName","user_role_id","placeholder","Select Role",3,"formGroup","options"],[1,"button","flex","w-full","justify-end","gap-2"],["loadingText","Saving...",3,"action","actionText","buttonStyle","loading","disabled"],[3,"action","actionText","buttonStyle"],[1,"text-2xl","font-semibold"],[1,"flex","justify-start","gap-1"],[3,"action","actionText","buttonStyle","icon"],["actionText","Add Skill",3,"buttonStyle","icon"],[3,"data","data$","columns","searchKey$"],["actionText","Delete","buttonStyle","danger","loadingText","Deleting...",3,"action"],["actionText","Add Skill",3,"action","buttonStyle","icon"]],template:function(i,n){i&1&&f(0,te,2,0,"div",2)(1,de,30,33),i&2&&h(n.loadingFetchApi()?0:1)},dependencies:[Q,G,I,z,P,K,J],encapsulation:2})}return t})();export{Ne as UserManagementComponent};
